# Estimated mortality reductions

```{r vaccinations-table, caption=c("Vaccinations administered under baseline and counterfactual scenarios"), echo=FALSE}
baseline = readRDS("data/owid_raw.Rds")
sooner_30 = readRDS("data/30_days_sooner.Rds")
sooner_60 = readRDS("data/60_days_sooner.Rds")
sooner_90 = readRDS("data/90_days_sooner.Rds")

counterfactuals = bind_rows(baseline, sooner_30, sooner_60, sooner_90) %>%
  filter(date <= primary_last_date)

vaccinations_table = counterfactuals %>%
  filter(date %in% c(
    as.Date('2021-01-01'),
    as.Date('2021-04-01'),
    as.Date('2021-07-01')
  )) %>%
  select(country, date, total_vacc, shifted_by) %>%
  mutate(
    total_vacc = format(total_vacc,
                        big.mark = ",",
                        trim = TRUE),
    shifted_by = mapvalues(
      shifted_by,
      from = c("baseline", "30", "60", "90"),
      to = c(
        "Baseline",
        "Vaccines 30 days sooner",
        "Vaccines 60 days sooner",
        "Vaccines 90 days sooner"
      )
    )
  ) %>%
  plyr::rename(
    c(
      "shifted_by" = "Counterfactual scenario"
    )
  ) %>%
  pivot_wider(names_from = date,
              values_from = total_vacc) %>%
  replace(is.na(.), '0') %>%
  arrange(country) %>%
  select(-country)

vaccinations_table %>%
  kbl(booktabs=TRUE, centering = TRUE, caption = "Total vaccinations under baseline and counterfactual scenarios",
      align=c("l", "r", "r", "r")) %>%
  pack_rows("United Kingdom", 1, 4) %>%
  pack_rows("United States", 5, 8)

```

```{r cumul-vacc-cfacts, fig.align="center", fig.cap=c("Cumulative vaccinations under baseline and counterfactual scenarios"), echo=FALSE}
baseline = readRDS("data/owid_raw.Rds")
sooner_30 = readRDS("data/30_days_sooner.Rds")
sooner_60 = readRDS("data/60_days_sooner.Rds")
sooner_90 = readRDS("data/90_days_sooner.Rds")

counterfactuals = bind_rows(baseline, sooner_30, sooner_60, sooner_90) %>%
  filter(date <= primary_last_date)

first_date_us = baseline %>% filter(iso3c == "USA") %>% head(1) %>% pull(date)
first_date_uk = baseline %>% filter(iso3c == "GBR") %>% head(1) %>% pull(date)
highlight_dates_us = c(first_date_us, first_date_us - 30, first_date_us - 60, first_date_us - 90, as.Date("2021-04-01"), as.Date("2021-07-01"))
highlight_dates_uk = c(first_date_uk, first_date_uk - 30, first_date_uk - 60, first_date_uk - 90, as.Date("2021-04-01"), as.Date("2021-07-01"))

lines = data.frame(country = c("United Kingdom", "United States"),
                   dates = c(first_date_uk, first_date_us))

breaks_fun = function(x) {
  # Only way to distinguish US and UK is that they start at different dates :(
  if (min(x) < as.integer(as.Date("2020-09-01"))) {
    return(highlight_dates_uk)
  } else {
    return(highlight_dates_us)
  }
}

labels_fun = function(b) {
  format(b, "%b-%d")
}

dj4 = ggplot(data = counterfactuals,
            aes(x = as.Date(date),
                y = total_vacc,
                color = shifted_by)) +
  geom_line() +
  facet_wrap(~country, ncol = 2, scales = "free") +
  scale_y_continuous(labels = unit_format(unit = "M", scale = 1e-6)) +
  scale_x_continuous(
    breaks = breaks_fun,
    labels = labels_fun
  ) + 
  scale_colour_manual(
    labels = c('30 days', '60 days', '90 days', 'baseline'),
    values = c(alpha(colour_counterfactual, 0.33), alpha(colour_counterfactual, 0.66), colour_counterfactual, colour_baseline)
  ) +
  labs(x = "Date",
       y = "Cumulative vaccinations",
       color = "Vaccinations starting sooner by:") +
  theme(axis.text.x=element_text(angle = 90, hjust = 0))

print(dj4)
```
Numbers of vaccine doses distributed under the base case and counterfactual models are given in Table \@ref(tab:vaccinations-table) and Figure \@ref(fig:cumul-vacc-cfacts). Focusing on our chosen period of up to 1 July 2021, we find 9% increase in the US in the doses administered and corresponding 20% increase for the UK, under the most optimistic scenario of vaccines being available 90 days earlier. However, the differences are much larger in the earlier periods. For example, up to 1 April 2021, the corresponding increases are 68% and 105% for the US and UK respectively.

```{r model-fit-deaths, fig.align="center", fig.cap=c("Comparison of real and modelled (baseline) deaths over time"), echo=FALSE}
deaths_averted = readRDS("data/reported_deaths_averted_detail.Rds")
data_for_plot3 = deaths_averted %>% 
  filter(counterfactual == 'owid_raw') %>% 
  select(iso3c, date, country, 
         deaths_avg, 
         deaths_025,
         deaths_975
  ) %>% 
  # join by deaths reported from 02-methods
  left_join(deaths_reported, by = c("iso3c", "date")) %>% 
  left_join(population, by = "iso3c") %>% 
  filter(date >= first_date) %>% 
  mutate(
    deaths_perpop = deaths_avg / pop10k,
    deaths_025_perpop = deaths_025 / pop10k,
    deaths_975_perpop = deaths_975 / pop10k,
    baseline_deaths_perpop = deaths_smoothed / pop10k
  ) %>% 
  pivot_longer(cols = c(deaths_perpop, baseline_deaths_perpop),
               names_to = "type")

fig3 = ggplot(data = data_for_plot3,
              aes(x = as.Date(date),
                y = value,
                color = type,
                linetype = type)) +
  geom_line() +
  geom_ribbon(
    aes(ymin = deaths_025_perpop, ymax = deaths_975_perpop, fill = colour_counterfactual),
    alpha = 0.2,
    color = NA,
    show.legend = FALSE
  ) +
  facet_wrap(~iso3c, 
             ncol = 2, 
             scales = "free_y", labeller = as_labeller(c(
               "GBR" = "United Kingdom",
               "USA" = "United States"
             ))) +
  scale_colour_manual(
    labels = c('Real deaths', 'Modelled deaths (baseline)'),
    values = c(colour_baseline, colour_counterfactual)
  ) +
  scale_linetype_manual(values = c("solid", "solid")) +
  labs(x = "Date",
       y = "Daily deaths per 10,000 people",
       color = "Type:") +
  guides(linetype = FALSE, scale = "none")
  
plot(fig3)
```
```{r deaths-averted-table, echo=FALSE}

differences_table <- deaths_averted_table_single(load_deaths_averted_table( excess = FALSE)) %>% select(-c("Baseline deaths", "Averted/baseline"))

differences_table %>%
  kbl(booktabs=TRUE, centering = TRUE, caption = "Total averted deaths under counterfactual scenarios, based on reported deaths") %>%
  pack_rows("United Kingdom to April 2021", 1, 3) %>%
  pack_rows("United Kingdom to July 2021", 4, 6) %>%
  pack_rows("United Kingdom to Jan 2022", 7, 9) %>%
  pack_rows("United States to April 2021", 10, 12) %>%
  pack_rows("United States to July 2021", 13, 15) %>%
  pack_rows("United States to Jan 2022", 16, 18) %>%
  kable_styling(font_size = 7)

```
Model fit is presented in Figure \@ref(fig:cumul-vacc-cfacts) and comparison of counterfactual scenarios over time in Figure \@ref(fig:model-fit-deaths). We summarise cumulative reductions in mortality in Table \@ref(tab:deaths-averted-table). In our main period of interest, up to 1 July 2021, our model suggests that for the UK accelerating availability of vaccines would have averted between 9,800 (assuming 30-day acceleration; lower 95% bound is 5,800) and 47,500 (90-day acceleration; upper 95% bound is 39,525) deaths. This translates to 1.5-7.1 deaths averted per 10,000 individuals or 14-50% reduction in total burden of deaths in the period between start of vaccinations and 1 July 2021. As a reminder, lower and upper bounds correspond to uncertainty in vaccine parameters.

In the US, corresponding numbers of deaths averted are 53,400 (lower 95% bound of 45,900) and 132,200 (upper 95% bound of 162,800) for 30-day and 90-day acceleration respectively. This gives a range of 1.6-4.0 deaths averted per 10,000 or 15-32% reduction in total burden of deaths in the period between start of vaccinations and 1 July 2021.

As these numbers suggest, the simulations for the UK are typically more sensitive to how much earlier the vaccines become available, likely due to higher vaccine uptake in the UK than in the US (also uptake of boosters: about 50% in the UK compared to only about 25% in the US up to 1 January 2022) and no binding constraints on vaccine availability in the UK even under the most optimistic scenario, unlike in the US. 

```{r deaths-averted-plot, fig.align="center", fig.cap=c("Daily deaths under baseline and counterfactual scenarios"), echo=FALSE}
deaths_averted = readRDS("data/reported_deaths_averted_detail.Rds")

zoomed_deaths_averted = deaths_averted %>%
  filter(date > as.Date("2020-09-01") & date <= primary_last_date) %>%
  filter(counterfactual %in% cfacts_to_display) %>%
  mutate(counterfactual_label = mapvalues(
    counterfactual,
    from = cfacts_to_display,
    to = labels_to_display
  )) %>%
  mutate(counterfactual_label = factor(counterfactual_label,
                                       labels_to_display)) %>%
  left_join(population, by = "iso3c") %>%
  mutate(
    deaths_025_perpop = deaths_025 / pop10k,
    deaths_975_perpop = deaths_975 / pop10k,
    baseline_deaths_avg_perpop = baseline_deaths_avg / pop10k,
    deaths_avg_perpop = deaths_avg / pop10k,
    cumulative_deaths_025_perpop = cumulative_deaths_025 / pop10k,
    cumulative_deaths_975_perpop = cumulative_deaths_975 / pop10k,
    baseline_cumulative_deaths_avg_perpop = baseline_cumulative_deaths_avg / pop10k,
    cumulative_deaths_avg_perpop = cumulative_deaths_avg / pop10k,
  )
  
baseline_color <- "#2C3E50" # dark blue
counterfactual1_color <- "#E74C3C" # red
counterfactual2_color <- "#27AE60" # green
counterfactual3_color <- "#F1C40F" # yellow

single_timeseries_plot = ggplot(data = zoomed_deaths_averted,
                                aes(x = as.Date(date),
                                    y = deaths_avg_perpop,
                                    color = counterfactual)) +
  geom_line() +
  geom_ribbon(
    aes(ymin = deaths_025_perpop, ymax = deaths_975_perpop, fill = counterfactual),
    alpha = 0.2,
    color = NA,
    show.legend = FALSE
  ) +
  geom_line(aes(y = baseline_deaths_avg_perpop, colour = "baseline")) +
  facet_wrap( ~ country) +
  scale_colour_manual(
    aesthetics = c("fill", "colour"),
    labels = c('30 days', '60 days', '90 days', 'baseline'),
    values = c(
      counterfactual1_color,
      counterfactual2_color,
      counterfactual3_color,
      baseline_color
    )
  ) +
  labs(x = "Date", y = "Daily Deaths per 10 000 people", color = "Earlier vaccines by:")

plot(single_timeseries_plot)
```
On the other hand, reductions in the UK are generally lower than in the US. This is likely due to the fact that benefits of vaccination are biggest if mass vaccination precedes rise in cases (for illustration see Fig S6 in Więcek et al. 2022). In the UK numbers of cases were already rapidly rising in winter 2020 and at the lower end of speed-up counterfactuals (30 days) only a small proportion of cases would be averted, because a small proportion of population would have been vaccinated before epidemic peak (see Figure \@ref(fig:deaths-averted-plot)). 

We also noted that while the simulations in the US are affected by the acceleration factor a bit less, within each counterfactual they are more uncertain. This is possibly also explained by the timing of epidemic peaks. Whereas in the UK the crucial parameter is timing of mass vaccination compared to epidemic peak, in the US the deaths are spread more evenly over time and therefore more sensitive to vaccine parameters such as efficacy or duration of protection.

## Results of alternative model specifications

Detailed results for alternative model specifications are in Appendix D and sensitivity to model parameters in Appendix C. Here we summarise our main findings.

**Cut-off dates for calculation of deaths averted.** If we extend the modelled period up to 1 January 2022, the average number of deaths averted generally increases (8,200 to 64,700 for the UK, 51,200 to 180,000 for the US; the ranges represent 30-day to 90-day accelerations). However, uncertainty increases too and we see a considerable “rebound” effect, where the number of deaths can even increase under some trajectories when compared to the status quo. This is because the model is very sensitive to duration of protection.

**Using excess deaths. **If using the excess deaths the effects show similar trends, but are generally smaller, sometimes by as much as a third. This diminished effect is somewhat to be expected, since excess deaths measure also includes non-COVID-attributable deaths and may therefore be less sensitive to increasing vaccination.[^16]

**Additional counterfactual analysis considering booster uptake. **Noting differences between the UK and the US (also in the extent variability in results), which had widely different levels of uptake of boosters in the considered period, we conducted an additional analysis, where we increased the uptake of third doses in the US to the same level as in the UK. However, we found that this modification does not account for the differences between the countries. 

**Decreased vaccination demand due to vaccine hesitancy. **If demand for vaccines was lower under the counterfactual scenario, the mortality reductions still persist, although they are diminished at the lower end of acceleration (30 days counterfactual): with 10% we estimate 7,500-44,500 deaths averted in the UK (compared to 9.8-47k range holding demand constant) up to 1 July 2021 and 40,000-115,000 in the US (compared to 53-132k range), with the range corresponding to three counterfactuals (30, 60, 90 days). However, if the decreased demand continued past summer, the mortality reductions would be much smaller.

**Sensitivity to misspecified vaccine parameters. **See Appendix C for details. Typically misspecifying vaccine efficacy (first two doses), DVI, or DNI led to decrease in estimated benefits, sometimes by a considerable margin (one-third or even half of the reductions seen under the base case), but in a few cases we also saw increases in benefits. Overall these results suggest large sensitivity to parameter misspecification. 

[^16]: In our main period of interest, up to 1 July 2021, our results suggest that for the UK accelerating availability of vaccines would have averted between 6,000 (assuming 30-day acceleration; lower 95% bound is 5,000) and 30,000 (90-day acceleration; upper 95% bound is 38,000) deaths. This translates to 0.9-4.8 deaths averted per 10,000. In the US, corresponding numbers of deaths averted are 43,000 (lower 95% bound of 38,000) and 123,000 (upper 95% bound of 151,000) for 30-day and 90-day acceleration respectively. This gives a range of 1.3-3.7 deaths averted per 10,000.
