---
output:
  pdf_document: default
  html_document: default
---
# Methods

## Baseline model

To model alternative vaccination timelines, we took an existing compartmental model that simulated the COVID-19 pandemic through 2020 and 2021 including the impact of vaccinations (the "baseline model") and re-ran the simulation freezing all parameters except the vaccination timelines (the "counterfactual models").

The baseline pandemic model used the model behind [@watsonoliverj.COVID19LMICReports2022]. This model is implemented in open source R packages Squire [@hoganWithincountryAgebasedPrioritisation2021, @walkerImpactCOVID19Strategies2020, @watsonLeveragingCommunityMortality2021] and SirCOVID [@baguelinSircovidSIRModel2022]. An older version of this model is described in detail in the supplementary material of [@walkerImpactCOVID19Strategies2020], and details of many parameters -- again, for an older version of the model -- can be found in the supplementary material of [@watsonGlobalImpactFirst2022]. Additional incomplete information about the parametrisation of the version of the model we used can be found at [COVID-19 LMIC Reports documentation](https://web.archive.org/web/20221230232942/https://mrc-ide.github.io/global-lmic-reports/parameters.html) [@watsonoliverj.COVID19LMICReports2022], and more up-to-date but less complete model structure can be found in the [Nimue documentation](https://web.archive.org/web/20221230232915/https://mrc-ide.github.io/nimue/index.html) [@winskillNimue]. Here we will describe the model in broad terms.

The baseline model is an age-stratified SEIRD model. In addition to classifying the population by infection status, the model also classifies people by vaccination status: they may be unvaccinated, vaccinated with 1 dose, vaccinated with 2 doses, vaccinated with 2 doses with waned protection, vaccinated 3 doses and vaccinated with 3 doses with waned protection. People are vaccinated according to vaccination dosage data from Our World in Data [@mathieuCoronavirusPandemicCOVID192020] together with a model of vaccine prioritisation. They progress to "waned" classes according to an assumed rate of waning of vaccine-derived immunity, which is itself time and dose-number-dependent. The model accounts for separate modes of vaccine action (infection blocking vs disease blocking), variant-dependent efficacy of vaccine and naturally derived immunity and age-dependent vaccination strategies. 

The model assumes homogenous mixing of the population. It models different kinds of infection -- "severe" and "non-severe" -- which have different age-dependent probabilities of progressing to recovery or death. Individuals who have recovered are assumed to be fully protected by natural immunity for an exponentially random duration duration which is, on average, around 250 days. Individuals who have been vaccinated have different levels of protection at different points in time depending on the dominant strain, and unless they receive additional doeses then protection is considered to have waned after an exponentially random period of time (on average, around 150 days). Vaccinated individuals are also considered to have a reduced likelihood of onward transmission, which also fades when the vaccine protection wanes.

The model features deterministic parameters, random parameters and derived parameters. We run an ensemble of simulations for each country, sampling the random parameters at the start of each run from pre-defined distributions. There are three derived parameters: the duration of vaccine-derived immunity, the initial number of cases seeding the pandemic in the country and the time series of reproduction numbers of infections in a fully susceptible population $R_t$. The duration of vaccine derived immunity is derived from the sampled efficacy of vaccination against infection by simulating an antibody decay curve [@watsonoliverj.COVID19LMICReports2022]. The initial number of cases and the timeseries of effective reproductive numbers is subsequently chosen such that the model outputs fit the observations - either of excess or officially reported deaths. We report the central estimates of vaccine efficacy in Table \@ref{tab:vaccine-efficacy}.

We made one change to the model used by [@watsonoliverj.COVID19LMICReports2022]: by default, vaccination was assumed to reduce onward transmission by 50%, regardless of whether the dose was fresh or waned. We modified this to the schedule shown in Table \@ref(tab:onward). These represented an average between the estimates of [@eyreImpactSARSCoV2Vaccination2021a] for effectiveness at blocking onward transmission of Alpha and Delta and the estimate of [@tanInfectiousnessSARSCoV2Breakthrough2023] for effectiveness of the vaccine at blocking onward transmission of Omicron, as the period of the simulation included both Delta and Omicron waves.

As the documentation for older models does not cover the parameters for booster vaccines or efficacy vs the Omicron strain, we report central estimates of efficacies in Table \@ref(tab:vaccine-efficacy).

```{r onward, tidy=FALSE, echo=FALSE, caption=c('Assumed relative transmissibility of infection by vaccinated individuals compared to unvaccinated')}

vaccine_onward_protection <- data.frame(
    'Doses' = c(
      '1 dose (fresh)', 
      '2 doses (fresh)', 
      '2 doses (waned)',
      '3 doses (fresh)',
      '3 doses (waned stage 1)',
      '3 doses (waned stage 2)'
      ),
    'Protection from onward transmission' = c(
      '27%', 
      '27%', 
      '0%',
      '30%',
      '10%',
      '5%'
      )
    )

vaccine_onward_protection %>% kbl(
  booktabs = TRUE,
  col.names = c('Doses', 'Protection from onward transmission'),
  linesep = "",
  caption = 'Assumed relative transmissibility of infection by vaccinated individuals compared to unvaccinated',
  centering = TRUE
  )
```

```{r vaccine-efficacy, tidy=FALSE, echo=FALSE, caption=c('Model parameters - central estimates of vaccine efficacy')}

vaccine_efficacy <- data.frame(
    'Vaccine type' = c('mRNA', 'mRNA', 'mRNA', 'mRNA', 'mRNA', 'mRNA', 'mRNA'), 
    'Doses' = c('1', '2', '1', '2', '1', '2', '3'),
    'Strain' = c('Wild', 'Wild', 'Delta', 'Delta', 'Omicron', 'Omicron', 'Omicron'),
    'Protection against infection' = c('0.63', '0.86', '0,36', '0.88', '0', '0.136', '0.65'))

vaccine_efficacy %>% kbl(
  booktabs = TRUE,
  col.names = c('Vaccine type', 'Doses', 'Strain', 'Protection against infection'),
  linesep = "",
  caption = 'Model parameters - central estimates of vaccine efficacy',
  centering = TRUE
)
```


## Vaccine production

To produce counterfactual vaccine dosage timeseries, we suppose that vaccine approcal is brought forward by a number of days (we test approval coming 30, 60 and 90 day sooner). However, if approval is brought forward too much then manufacturers might have a harder time maintaining supply than they would have in the situation that actually played out. We model this by ... (see Tomas' entry in the shared doc)

Plots can currently be found in [Vaccine production model]